<div class="mx-auto p-4 space-y-4">
  <h1 class="text-3xl font-semibold text-center">Unos termina</h1>
  <div class="grid md:grid-cols-2 md:gap-4">
    <form (submit)="$event.preventDefault()">
      <h2 class="text-2xl font-semibold text-center">Novi termin</h2>

      <div>
        <label for="name" class="block">Ime</label>
        <div class="flex items-center gap-2">
          <input
            class="border rounded px-3 py-2 w-full mb-4"
            type="text"
            id="name"
            name="name"
            placeholder="Ime klijentice"
            [formControl]="nameControl"
            [matAutocomplete]="auto"
            (input)="onNameInputChange($event)"
            required
          />
          <mat-autocomplete
            #auto="matAutocomplete"
            (optionSelected)="onClientSelected($event.option.value)"
            [displayWith]="displayClientName"
          >
            @for (c of filteredClients$ | async; track c.id) {
            <mat-option [value]="c">{{ c.name }}</mat-option>
            }
          </mat-autocomplete>

          <button
            type="button"
            class="shrink-0 border rounded px-3 py-2 mb-4 hover:bg-gray-100 transition"
            (click)="toggleExtra()"
            aria-expanded="{{ showExtra }}"
            aria-controls="extra-fields"
            title="Dodatni podaci"
          >
            <!-- ikona -->
            <svg
              class="w-6 h-6 text-gray-800"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m8 7 4 4 4-4m-8 6 4 4 4-4"
              />
            </svg>
          </button>
        </div>

        <!-- Dodatna polja -->
        <div
          id="extra-fields"
          class="overflow-hidden transition-all duration-300"
          [class.max-h-0]="!showExtra"
          [class.max-h-40]="showExtra"
        >
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label for="phone" class="block text-sm mb-1">Telefon (opcionalno)</label>
              <input
                id="phone"
                name="phone"
                type="tel"
                class="border rounded px-3 py-2 w-full"
                [(ngModel)]="phone"
                placeholder=""
              />
            </div>
            <div>
              <label for="ig" class="block text-sm mb-1">Instagram (opcionalno)</label>
              <input
                id="ig"
                name="ig"
                type="text"
                class="border rounded px-3 py-2 w-full"
                [(ngModel)]="ig"
                placeholder=""
              />
            </div>
          </div>
        </div>
      </div>

      <div class="mt-2">
        <label class="">Odaberi uslugu</label>
        <select
          class="border rounded px-3 py-2 w-full mb-4"
          [(ngModel)]="selectedServiceId"
          name="service"
        >
          <option value="" disabled selected>Odaberi uslugu</option>
          @for (service of services; track service.id) {
          <option [ngValue]="service.id">{{ service.serviceName }} - {{ service.price }}€</option>
          }
        </select>
      </div>

      <div class="max-w-md">
        <label class="block text-sm mb-1">Datum</label>
        <mat-card>
          <mat-calendar
            [(selected)]="selected"
            (selectedChange)="onDateChanged($event)"
          ></mat-calendar>
        </mat-card>
        <p class="text-sm text-gray-600 mt-2">
          Odabrano: <strong>{{ selected | date : 'EEEE, d. MMMM y' : '' : 'hr-HR' }}</strong>
        </p>
      </div>

      <mat-card class="mt-3">
        <mat-card-title>Trenutni odabir</mat-card-title>
        <mat-card-content>
          <div><strong>Klijent:</strong> {{ selectedClient?.name || name || '—' }}</div>
          <div><strong>Datum:</strong> {{ selected | date : 'dd.MM.yyyy.' }}</div>
          <div><strong>Vrijeme:</strong> {{ time || '—' }}</div>
          <div>
            <strong>Usluga:</strong>
            {{ selectedService?.serviceName || '—' }}
            @if (selectedService) {<ng-container>
              ({{
                selectedService.price | currency : 'EUR' : 'symbol' : '1.0-0' : 'hr-HR'
              }}) </ng-container
            >}
          </div>
        </mat-card-content>
      </mat-card>

      <div class="mt-4 flex items-center gap-2">
        <button
          type="submit"
          class="px-4 py-2 rounded bg-black text-white disabled:opacity-50"
          [disabled]="saving"
          (click)="saveAppointment()"
        >
          {{ saving ? 'Spremam…' : 'Spremi termin' }}
        </button>
      </div>
    </form>

    <div class="border rounded p-4 mt-3">
      <div class="flex items-center gap-2 mb-3">
        <button type="button" class="px-3 py-2 border rounded" (click)="shiftDay(-1)">←</button>
        <button type="button" class="px-3 py-2 border rounded" (click)="goToday()">Today</button>
        <button type="button" class="px-3 py-2 border rounded" (click)="shiftDay(1)">→</button>

        <div class="ml-auto text-sm text-gray-600">
          {{ selected | date : 'EEEE, d. MMMM y' : '' : 'hr-HR' }}
        </div>
      </div>

      <h3 class="text-lg font-semibold mb-2">Vrijeme (45 min slotovi)</h3>

      <div class="grid grid-cols-2 gap-2">
        @for (s of slots; track s.label) {
        <button
          type="button"
          class="px-3 py-2 rounded border hover:bg-gray-50 text-left"
          (click)="time = s.label"
        >
          {{ s.label }}
        </button>
        }
      </div>
    </div>
  </div>
</div>
